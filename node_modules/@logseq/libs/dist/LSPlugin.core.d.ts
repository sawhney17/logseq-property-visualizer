import EventEmitter from 'eventemitter3';
import { deferred } from './helpers';
import * as pluginHelpers from './helpers';
import { LSPluginCaller } from './LSPlugin.caller';
import { ILSPluginThemeManager, ThemeOptions } from './LSPlugin';
declare global {
    interface Window {
        LSPluginCore: LSPluginCore;
    }
}
declare type DeferredActor = ReturnType<typeof deferred>;
declare type LSPluginCoreOptions = {
    dotConfigRoot: string;
};
/**
 * User settings
 */
declare class PluginSettings extends EventEmitter<'change'> {
    private _userPluginSettings;
    private _settings;
    constructor(_userPluginSettings: any);
    get<T = any>(k: string): T;
    set(k: string | Record<string, any>, v?: any): void;
    set settings(value: Record<string, any>);
    get settings(): Record<string, any>;
    toJSON(): Record<string, any>;
}
declare class PluginLogger extends EventEmitter<'change'> {
    private _tag;
    private _logs;
    constructor(_tag: string);
    write(type: string, payload: any[]): void;
    clear(): void;
    info(...args: any[]): void;
    error(...args: any[]): void;
    warn(...args: any[]): void;
    toJSON(): [type: string, payload: any][];
}
declare type UserPreferences = {
    theme: ThemeOptions;
    externals: Array<string>;
    [key: string]: any;
};
declare type PluginLocalOptions = {
    key?: string;
    entry: string;
    url: string;
    name: string;
    version: string;
    mode: 'shadow' | 'iframe';
    settings?: PluginSettings;
    logger?: PluginLogger;
    effect?: boolean;
    [key: string]: any;
};
declare type PluginLocalUrl = Pick<PluginLocalOptions, 'url'> & {
    [key: string]: any;
};
declare type RegisterPluginOpts = PluginLocalOptions | PluginLocalUrl;
declare type PluginLocalIdentity = string;
declare enum PluginLocalLoadStatus {
    LOADING = "loading",
    UNLOADING = "unloading",
    LOADED = "loaded",
    UNLOADED = "unload",
    ERROR = "error"
}
/**
 * Host plugin for local
 */
declare class PluginLocal extends EventEmitter<'loaded' | 'unloaded' | 'beforeunload' | 'error'> {
    private _options;
    private _themeMgr;
    private _ctx;
    private _disposes;
    private _id;
    private _status;
    private _loadErr?;
    private _localRoot?;
    private _dotSettingsFile?;
    private _caller?;
    /**
     * @param _options
     * @param _themeMgr
     * @param _ctx
     */
    constructor(_options: PluginLocalOptions, _themeMgr: ILSPluginThemeManager, _ctx: LSPluginCore);
    _setupUserSettings(reload?: boolean): Promise<() => void>;
    getMainUIContainer(): HTMLElement | undefined;
    _resolveResourceFullUrl(filePath: string, localRoot?: string): string;
    _preparePackageConfigs(): Promise<() => Promise<void>>;
    _tryToNormalizeEntry(): Promise<void>;
    _loadConfigThemes(themes: Array<ThemeOptions>): Promise<void>;
    _persistMainUILayoutData(e: {
        width: number;
        height: number;
        left: number;
        top: number;
    }): void;
    _setupDraggableContainer(el: HTMLElement, opts?: Partial<{
        key: string;
        title: string;
        close: () => void;
    }>): () => void;
    _setupResizableContainer(el: HTMLElement, key?: string): () => void;
    load(opts?: Partial<{
        indicator: DeferredActor;
        reload: boolean;
    }>): Promise<void>;
    reload(): Promise<void>;
    /**
     * @param unregister If true delete plugin files
     */
    unload(unregister?: boolean): Promise<boolean>;
    private dispose;
    _dispose(fn: any): void;
    _onHostMounted(callback: () => void): void;
    get layoutCore(): any;
    get isInstalledInDotRoot(): boolean;
    get loaded(): boolean;
    get pending(): boolean;
    get status(): PluginLocalLoadStatus;
    get settings(): PluginSettings;
    get logger(): PluginLogger;
    get disabled(): any;
    get caller(): LSPluginCaller;
    get id(): string;
    get shadow(): boolean;
    get options(): PluginLocalOptions;
    get themeMgr(): ILSPluginThemeManager;
    get debugTag(): string;
    get localRoot(): string;
    get loadErr(): Error | undefined;
    get dotConfigRoot(): string;
    get dotSettingsFile(): string | undefined;
    get dotPluginsRoot(): string;
    toJSON(): any;
}
/**
 * Host plugin core
 */
declare class LSPluginCore extends EventEmitter<'beforeenable' | 'enabled' | 'beforedisable' | 'disabled' | 'registered' | 'error' | 'unregistered' | 'theme-changed' | 'theme-selected' | 'settings-changed' | 'unlink-plugin' | 'beforereload' | 'reloaded'> implements ILSPluginThemeManager {
    private _options;
    private _isRegistering;
    private _readyIndicator?;
    private _hostMountedActor;
    private _userPreferences;
    private _registeredThemes;
    private _registeredPlugins;
    private _currentTheme;
    /**
     * @param _options
     */
    constructor(_options: Partial<LSPluginCoreOptions>);
    loadUserPreferences(): Promise<void>;
    saveUserPreferences(settings: Partial<UserPreferences>): Promise<void>;
    activateUserPreferences(): Promise<void>;
    /**
     * @param plugins
     * @param initial
     */
    register(plugins: Array<RegisterPluginOpts> | RegisterPluginOpts, initial?: boolean): Promise<void>;
    reload(plugins: Array<PluginLocalIdentity> | PluginLocalIdentity): Promise<void>;
    unregister(plugins: Array<PluginLocalIdentity> | PluginLocalIdentity): Promise<void>;
    enable(plugin: PluginLocalIdentity): Promise<void>;
    disable(plugin: PluginLocalIdentity): Promise<void>;
    _hook(ns: string, type: string, payload?: any, pid?: string): Promise<void>;
    hookApp(type: string, payload?: any, pid?: string): void;
    hookEditor(type: string, payload?: any, pid?: string): void;
    _execDirective(tag: string, ...params: any[]): void;
    ensurePlugin(plugin: PluginLocalIdentity | PluginLocal): PluginLocal;
    hostMounted(): void;
    get registeredPlugins(): Map<PluginLocalIdentity, PluginLocal>;
    get options(): Partial<LSPluginCoreOptions>;
    get readyIndicator(): DeferredActor | undefined;
    get hostMountedActor(): DeferredActor;
    get isRegistering(): boolean;
    get themes(): Map<PluginLocalIdentity, Array<ThemeOptions>>;
    registerTheme(id: PluginLocalIdentity, opt: ThemeOptions): Promise<void>;
    selectTheme(opt?: ThemeOptions, effect?: boolean): Promise<void>;
    unregisterTheme(id: PluginLocalIdentity, effect?: boolean): Promise<void>;
}
declare function setupPluginCore(options: any): void;
export { PluginLocal, pluginHelpers, setupPluginCore };
